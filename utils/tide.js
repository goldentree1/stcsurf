import { connectMongo } from './mongoDb';
import { Tide } from 'models/Tide';

//Returns tide data for given location ID and date
export async function getTide(id, date = new Date()) {
    connectMongo();
    return await Tide.findOne({
        location: id,
        retrieved: {
            $lte: new Date(date)
        }
    }).sort({ retrieved: 'desc' });
}


//TEST
export function getTideTest() {
    return tideData2;
}


const tideData2 = JSON.parse(`
{
    "data": [
        {
            "height": 0.7895832437379304,
            "time": "2022-11-09T15:56:00+00:00",
            "type": "high"
        },
        {
            "height": -0.6922451326408093,
            "time": "2022-11-09T22:08:00+00:00",
            "type": "low"
        },
        {
            "height": 0.6610164754740828,
            "time": "2022-11-10T04:13:00+00:00",
            "type": "high"
        },
        {
            "height": -0.7113567898137741,
            "time": "2022-11-10T10:22:00+00:00",
            "type": "low"
        },
        {
            "height": 0.7301463091010639,
            "time": "2022-11-10T16:41:00+00:00",
            "type": "high"
        },
        {
            "height": -0.6114741515420801,
            "time": "2022-11-10T22:53:00+00:00",
            "type": "low"
        },
        {
            "height": 0.5910099313971973,
            "time": "2022-11-11T04:57:00+00:00",
            "type": "high"
        },
        {
            "height": -0.6332186286790785,
            "time": "2022-11-11T11:06:00+00:00",
            "type": "low"
        },
        {
            "height": 0.6691439946341313,
            "time": "2022-11-11T17:26:00+00:00",
            "type": "high"
        },
        {
            "height": -0.540546109125606,
            "time": "2022-11-11T23:40:00+00:00",
            "type": "low"
        },
        {
            "height": 0.5253284229998596,
            "time": "2022-11-12T05:43:00+00:00",
            "type": "high"
        },
        {
            "height": -0.5625960434527636,
            "time": "2022-11-12T11:52:00+00:00",
            "type": "low"
        },
        {
            "height": 0.6131712678173115,
            "time": "2022-11-12T18:13:00+00:00",
            "type": "high"
        },
        {
            "height": -0.4869029663729764,
            "time": "2022-11-13T00:29:00+00:00",
            "type": "low"
        },
        {
            "height": 0.46938510935079536,
            "time": "2022-11-13T06:33:00+00:00",
            "type": "high"
        },
        {
            "height": -0.5071981173340968,
            "time": "2022-11-13T12:40:00+00:00",
            "type": "low"
        },
        {
            "height": 0.5681375997571074,
            "time": "2022-11-13T19:03:00+00:00",
            "type": "high"
        },
        {
            "height": -0.4558355905888046,
            "time": "2022-11-14T01:21:00+00:00",
            "type": "low"
        },
        {
            "height": 0.4291848361696479,
            "time": "2022-11-14T07:26:00+00:00",
            "type": "high"
        },
        {
            "height": -0.473294038344139,
            "time": "2022-11-14T13:32:00+00:00",
            "type": "low"
        },
        {
            "height": 0.5389438255134106,
            "time": "2022-11-14T19:56:00+00:00",
            "type": "high"
        },
        {
            "height": -0.4498762776036667,
            "time": "2022-11-15T02:14:00+00:00",
            "type": "low"
        },
        {
            "height": 0.41030059255236856,
            "time": "2022-11-15T08:21:00+00:00",
            "type": "high"
        },
        {
            "height": -0.4646577139097621,
            "time": "2022-11-15T14:26:00+00:00",
            "type": "low"
        },
        {
            "height": 0.5283329749784741,
            "time": "2022-11-15T20:49:00+00:00",
            "type": "high"
        }
    ],
    "meta": {
        "cost": 1,
        "dailyQuota": 10,
        "datum": "MSL",
        "end": "2022-11-19 11:00",
        "lat": -45.922,
        "lng": 170.518,
        "requestCount": 1,
        "start": "2022-11-09 11:00",
        "station": {
            "distance": 5,
            "lat": -45.879,
            "lng": 170.513,
            "name": "dunedin",
            "source": "sg"
        }
    }
}`)
const tideData = JSON.parse(`{
    "data": [
        {
            "height": -0.8493416333761515,
            "time": "2022-11-02T16:10:00+00:00",
            "type": "low"
        },
        {
            "height": 0.8687034268815497,
            "time": "2022-11-02T22:33:00+00:00",
            "type": "high"
        },
        {
            "height": -0.8359677771761043,
            "time": "2022-11-03T04:47:00+00:00",
            "type": "low"
        },
        {
            "height": 0.7958744716989105,
            "time": "2022-11-03T11:01:00+00:00",
            "type": "high"
        },
        {
            "height": -0.8896008345858766,
            "time": "2022-11-03T17:11:00+00:00",
            "type": "low"
        },
        {
            "height": 0.8858775291281007,
            "time": "2022-11-03T23:31:00+00:00",
            "type": "high"
        },
        {
            "height": -0.8849434082175112,
            "time": "2022-11-04T05:43:00+00:00",
            "type": "low"
        },
        {
            "height": 0.8444548065389123,
            "time": "2022-11-04T11:57:00+00:00",
            "type": "high"
        },
        {
            "height": -0.9174820676640659,
            "time": "2022-11-04T18:07:00+00:00",
            "type": "low"
        },
        {
            "height": 0.8906034048182988,
            "time": "2022-11-05T00:24:00+00:00",
            "type": "high"
        },
        {
            "height": -0.9171399214848576,
            "time": "2022-11-05T06:35:00+00:00",
            "type": "low"
        },
        {
            "height": 0.8777913831638536,
            "time": "2022-11-05T12:50:00+00:00",
            "type": "high"
        },
        {
            "height": -0.9214185394355925,
            "time": "2022-11-05T19:00:00+00:00",
            "type": "low"
        },
        {
            "height": 0.8768377856111013,
            "time": "2022-11-06T01:14:00+00:00",
            "type": "high"
        },
        {
            "height": -0.9237728278714425,
            "time": "2022-11-06T07:24:00+00:00",
            "type": "low"
        },
        {
            "height": 0.8886371726286888,
            "time": "2022-11-06T13:39:00+00:00",
            "type": "high"
        },
        {
            "height": -0.8965976594610122,
            "time": "2022-11-06T19:50:00+00:00",
            "type": "low"
        },
        {
            "height": 0.8433680643542456,
            "time": "2022-11-07T02:01:00+00:00",
            "type": "high"
        },
        {
            "height": -0.9021015816866733,
            "time": "2022-11-07T08:11:00+00:00",
            "type": "low"
        },
        {
            "height": 0.8752257840267685,
            "time": "2022-11-07T14:27:00+00:00",
            "type": "high"
        },
        {
            "height": -0.8449527411075651,
            "time": "2022-11-07T20:37:00+00:00",
            "type": "low"
        },
        {
            "height": 0.7928266535102622,
            "time": "2022-11-08T02:46:00+00:00",
            "type": "high"
        },
        {
            "height": -0.8547593562069318,
            "time": "2022-11-08T08:55:00+00:00",
            "type": "low"
        },
        {
            "height": 0.8403012582849453,
            "time": "2022-11-08T15:12:00+00:00",
            "type": "high"
        },
        {
            "height": -0.7735437144328268,
            "time": "2022-11-08T21:23:00+00:00",
            "type": "low"
        },
        {
            "height": 0.7301366468825031,
            "time": "2022-11-09T03:30:00+00:00",
            "type": "high"
        },
        {
            "height": -0.788283452975015,
            "time": "2022-11-09T09:39:00+00:00",
            "type": "low"
        },
        {
            "height": 0.7895833421288254,
            "time": "2022-11-09T15:56:00+00:00",
            "type": "high"
        },
        {
            "height": -0.6922452063701843,
            "time": "2022-11-09T22:08:00+00:00",
            "type": "low"
        },
        {
            "height": 0.6610166103771746,
            "time": "2022-11-10T04:13:00+00:00",
            "type": "high"
        },
        {
            "height": -0.7113569353293181,
            "time": "2022-11-10T10:22:00+00:00",
            "type": "low"
        },
        {
            "height": 0.7301463630778365,
            "time": "2022-11-10T16:41:00+00:00",
            "type": "high"
        },
        {
            "height": -0.6114741876319628,
            "time": "2022-11-10T22:53:00+00:00",
            "type": "low"
        },
        {
            "height": 0.5910100100871857,
            "time": "2022-11-11T04:57:00+00:00",
            "type": "high"
        },
        {
            "height": -0.6332187168246184,
            "time": "2022-11-11T11:06:00+00:00",
            "type": "low"
        },
        {
            "height": 0.6691440213069688,
            "time": "2022-11-11T17:26:00+00:00",
            "type": "high"
        },
        {
            "height": -0.5405461238912737,
            "time": "2022-11-11T23:40:00+00:00",
            "type": "low"
        },
        {
            "height": 0.5253284644943225,
            "time": "2022-11-12T05:43:00+00:00",
            "type": "high"
        }
    ],
    "meta": {
        "cost": 1,
        "dailyQuota": 10,
        "datum": "MSL",
        "end": "2022-11-12 11:00",
        "lat": -45.922,
        "lng": 170.518,
        "requestCount": 1,
        "start": "2022-11-02 11:00",
        "station": {
            "distance": 5,
            "lat": -45.879,
            "lng": 170.513,
            "name": "dunedin",
            "source": "sg"
        }
    }
}`);
